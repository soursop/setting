# Introduction

각 토픽에 메시지를 보낼 수 있는 큐 시스템
각 토픽에 프로듀서는 메시지를 보내고, 컨슈머는 소비 가능함
다중 브로커(서버)를 통해 클러스터 제공 가능

# Topics 과 Logs

각 토픽마다 Kafka 클러스터는 로그를 파티션화 시켜 저장한다.

왜 파티션화를 시킬카?
보통 scale out을 위해서다. 
1. 분산저장 : 서버마다 각기 다른 파티션을 복제 저장하여, 다운되었을 경우를 대비
2. 병항처리 : 최대한 파티션을 쪼개어 데이터 요청이 한쪽 서버에만 가지 않게 하기 위해

그렇다면 저장된 메시지는 소비후 사라지는가?
Kafka에 저장된 메시지는 소비되든 소비되지 않은 일정기간동안 저장이 가능하다. (신뢰성 있는 데이터 보관 가능)

컨슈머는 offset(각 파티션에 저장된 인덱스 번호)설정을 조정하여 데이터 접근이 가능하다.

# 분산

leader(*)~followers 서버가 존재 가능 (마스터 디비, 슬레이브 디비 개념)

# Consumers

다음 2가지의 기능 제공
1. queuing : 단일 컨슈머에게 메시지 제공
2. publish-subscribe : 각 consumers에게 broadcast 메시지 전송

그럼 Kafka의 큐는 뭐가 다를까?
일반 서버의 경우 큐에 삽입된 메시지 순서로 메시지를 전송하지만, 카프카의 경우 async하게 메시지를 전송한다. (더 효율적으로 메시지 소비)
만약 컨슈머가 다중 서버로 구성되어 있다면 더 효과를 볼 수 있다.
보통 메시지 시스템은 상호배제 컨슈머(메시지를 전송할때까지 다른 컨슈머 접근을 못하게 함. 블럭개념) 개념을 이용한다. 즉 병렬처리를 이용하지 않는다는 의미이다.

카프카는 각 컨슈머에게 데이터 순서대로 데이터를 전송하는 것을 보장 한다. 각 1개의 파티션마다 1개의 컨슈머에게만 전송을 한다. 그리고 파티션 개수는 컨슈머 인스턴스에 따라 조정된다. 따라서 파티션 개수 이상의 컨슈머는 존재하지 않는다.

Q. 파티션이 많이 나눠지면 성능상 문제는?
인덱스와 비슷한 논리인듯, 오히려 파티션이 컨슈머가 증가됨에 따라 잘 쪼개져 있으면 성능상의 강점이 될듯.
Q. 왜 1개 파티션마다 1개의 컨슈머를 할당하나? 이유가 뭘까?
1개의 파티션에 2개의 컨슈머가 데이터를 받아와야 할 경우는 없는가?
컨슈머는 비즈니스 카테고리(토픽)를 기준으로 데이터를 받음. 파티션은 물리적인 데이터 분산을 위한 분할이므로, 특정 컨슈머가 특정 파티션에 데이터를 받아야 할 이유가 없는듯 보인다. 물리적으로 어디 저장되어있느냐에 따라 데이터를 받는 것이 아니라, 어떤 정보일 경우에만 받는다로 설정이 되어 있을테니 말이다.


